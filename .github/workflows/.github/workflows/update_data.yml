name: Auto Update Data

on:
  schedule:
    - cron: "0 */12 * * *"   # Updates every 12 hours
  workflow_dispatch:

jobs:
  update-data:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Update data.json
        run: |
          import json
          import datetime

          with open("data.json", "r") as f:
            data = json.load(f)

          now = datetime.datetime.utcnow().strftime("%Y-%m-%d %H:%M UTC")

          # Append a timestamp entry to latest_updates
          data.setdefault("latest_updates", [])
          data["latest_updates"].insert(0, {
              "title": f"Auto-update check performed at {now}"
          })

          # Keep only last 10 updates
          data["latest_updates"] = data["latest_updates"][:10]

          with open("data.json", "w") as f:
            json.dump(data, f, indent=2)

      - name: Commit changes
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          git add data.json
          git commit -m "Auto-update data.json" || echo "No changes to commit"

      - name: Push changes
        run: |
          git push
